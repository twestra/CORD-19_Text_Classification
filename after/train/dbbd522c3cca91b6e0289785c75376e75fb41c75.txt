Current procedures for inferring population history are generally performed under the 10 assumption of complete neutrality -that is, neglecting both direct selection and the effects of 11 selection on linked sites. We here examine how the presence of purifying and background 12 selection may bias demographic inference by evaluating two commonly-used methods (MSMC 13 and fastsimcoal2), specifically studying how the underlying shape of the distribution of fitness 14 effects (DFE) and the fraction of directly selected sites interacts with demographic parameter 15 estimation. The results demonstrate that, even after masking functional genomic regions, 16 background selection effects may result in the mis-inference of population growth under models 17 of both constant population size as well as decline. This effect is amplified as the strength of 18 purifying selection and the density of directly selected sites increases. We propose a potential 19 solution to correct for this mis-inference. By treating the DFE as a nuisance parameter and 20 averaging across all potential realizations, we demonstrate that even directly selected sites may 21 be used to infer demographic histories with reasonable accuracy. 22 23
demographic non-equilibrium, the DFE shape was scaled with respect to the ancestral population 124 size. 125
Three different demographic models were tested for each of these DFEs: 1) demographic 126 equilibrium, 2) recent exponential 30-fold growth resembling that estimated for the human CEU 127 population (Gutenkunst et al. 2009 ), and 3) ~6-fold instantaneous decline, resembling the out-of-128
Africa bottleneck in humans (Gutenkunst et al. 2009 ). The precise parameters of these three 129 scenarios are given in Supp. Table 1 and are also displayed in Figure 1a . (used with default parameters as provided by the package) was used to correct for the 167 relationship between parameters and statistics. To infer posterior estimates, a tolerance of 0.1 168 was applied (i.e., 10% of the total number of simulations were accepted by ABC to estimate the 169 posterior probability of each parameter). The weighted medians of the posterior estimates for 170 each parameter were used as point estimates. ABC inference was performed under two 171 conditions: (1) complete neutrality, and (2) in the presence of direct purifying selection. In both 172 cases only 2 parameters were inferred -ancestral (Nanc) and current (Ncur) population sizes. 173 However, in scenario 2, the shape of the DFE was also varied. Specifically, the parameters f0, f1, 174 f2, and f3 were treated as nuisance parameters and were sampled such that 0 ≤ f i ≤ 1, and Σi fi = 1, 175 for i = 0 to 3. In addition, in order to limit the computational complexity involved in the ABC 176 framework, values of fi were restricted to multiples of 0.05 (i.e., fi ϵ {0.0, 0.05, 0.10, …, 0.95, 177 1.0} ∀ i), which allowed us to sample 1,771 different DFE realizations. Simulations were 178 performed with functional genomic regions, and the demographic model was characterized by 1-179 epoch changes in which the population either grows or declines exponentially from ancestral to 180 current size, beginning at a fixed time in the past. For the purpose of illustration, and for 181 comparison with the human-like parameter set above, parameters for ABC testing were selected 182 to resemble those of D. melanogaster African populations. Priors on ancestral and current 183 population sizes were drawn from a uniform distribution between 10 5 -10 7 diploid individuals, 184 . CC-BY-ND 4.0 International license was not certified by peer review) is the author/funder. It is made available under a The copyright holder for this preprint (which this version posted April 29, 2020. . https://doi.org/10.1101/2020.04.28.066365 doi: bioRxiv preprint while the time of change was fixed at 10 6 (~Ne) generations. In order to simulate functional 185 regions, 94 single-exon genes, as described in Johri et al. (2020) Mutation rates were assumed to be fixed at 3 × 10 -9 per site per generation (Keightley et al. , 190 2014 ). All of these parameters were scaled by the factor 320 in order to decrease computational 191 time. The scaled population sizes thus ranged between ~300-30000 and were reported as scaled 192 values in the main text. One thousand replicate simulations were performed for every parameter 193 combination (Nanc, Ncur, f0, f1, f2, f3), 100 haploid genomes were randomly sampled without 194 replacement, and summary statistics were calculated using pylibseq 0.2.3 (Thornton 2003) . The accuracy and performance of demographic inference was evaluated using two popular 212 methods, MSMC (Schiffels and Durbin 2014) and fastsimcoal2 (Excoffier et al. 2013 ). In order 213 to assess performance, it was first necessary to determine how much genomic information is 214 required to make accurate inference when the assumptions of neutrality are met. Chromosomal 215 . CC-BY-ND 4.0 International license was not certified by peer review) is the author/funder. It is made available under a incorrect inferences for all segments smaller than 1 Gb (Supp Figure 1, Supp Figure 2 ). In 218 addition, when 4 or 8 haploid genomes were used for inference, MSMC inferred a recent many-219 fold growth for all segment sizes, but performed well when using 2 genomes for large segments 220 (Supp Figure 1) . These results suggest exercising caution when performing inference on smaller 221 regions or genomes, and when using more than 1 diploid individual in MSMC. All further 222 analyses were restricted to characterizing demographic inference on data that roughly matched 223 the structure and size of the human genome -for every diploid individual, 22 chromosomes of 224 size 150 Mb each were simulated, which amounted to roughly 3 Gb of total sequence. Ten 225 independent replicates of each parameter combination were performed throughout and inference 226 was performed using 1 and 50 diploid individuals for MSMC and fastsimcoal2, respectively. four bins: 0 ≤ |2Nes| < 1, 1 ≤ |2Nes| ≤ 10, 10 < |2Nes| ≤ 100 and 100 < |2Nes| ≤ 2Ne. Fitness effects 235 of mutations were uniformly distributed within each bin and the DFE shape was altered by 236 varying the proportion of mutations belonging to each fixed bin, given by f0, f1, f2, and f3, 237 respectively. Three highly skewed DFEs were initially used to assess the impact of the strength 238 of selection on demographic inference (with the remaining mutations equally distributed 239 amongst the other three classes): (1) a DFE in which 70% of mutations have weakly deleterious 240 fitness effects (i.e., f1 = 0.7), (2) a DFE in which 70% of mutations have moderately deleterious 241 fitness effects (i.e., f2 = 0.7), and (3) a DFE in which 70% of mutations have strongly deleterious 242 fitness effects (i.e., f3 = 0.7). In order to understand the effect of BGS, exonic sites were masked, 243 and only linked neutral intergenic sites were used for demographic inference. Three demographic 244 models were examined: (1) demographic equilibrium, (2) a 30-fold exponential growth, 245 mimicking the recent growth experienced by European human populations, and (3) ~6-fold 246 . CC-BY-ND 4.0 International license was not certified by peer review) is the author/funder. It is made available under a The copyright holder for this preprint (which this version posted April 29, 2020. . https://doi.org/10.1101/2020.04.28.066365 doi: bioRxiv preprint instantaneous decline, mimicking the out-of-Africa bottleneck in human populations ( Figure 1a) . 247
Although these models were parameterized using previous estimates of human demographic 248 history (Supp Table 1 The copyright holder for this preprint (which this version posted April 29, 2020. . https://doi.org/10.1101/2020.04.28.066365 doi: bioRxiv preprint
Although we have shown that the presence of purifying selection biases demographic inference, 279 the extent of mis-inference will necessarily depend on the fraction of the genome experiencing 280 direct selection. We therefore compared models in which genomes contained 5%, 10%, and 20% 281 functional regions. For this comparison, an equal proportion of mutations in each DFE bin were 282 assumed (i.e., f0 = f1 = f2 = f3 = 0.25). As before, when the true model is exponential growth, 283 inference was unbiased, with a slight underestimation of ancestral population size when 20% of 284 the genome is under selection (Figure 3) . When the true model is population decline, it is 285 inferred reasonably well if less than 10% of the genome experiences direct selection, and may be 286 mis-inferred as growth with greater functional density, as shown in Figure 3 . Similarly, the 287 extent to which population size is under-estimated at demographic equilibrium increases with the 288 fraction of the genome under selection. Finally, it is noteworthy that many such changes in 289 population size that were falsely inferred were of a magnitude greater than 2-fold -suggesting 290 the need for great caution when interpreting these plots from empirical data. 291 Importantly, the results presented do not significantly differ between inference performed 292 while including directly selected sites (i.e., no masking of functional regions) versus inference 293 performed using linked neutral sites (i.e., masking functional regions) as shown in Supp Figure  294 4. These results suggest that the exclusion of exonic sites, which is often assumed to provide a 295 sufficiently neutral dataset to enable accurate demographic inference, is not necessarily a 296 satisfactory solution unless gene density is low. 297 298 A potential solution: averaging across all possible DFEs 299
As shown above, demographic inference can be strongly affected by unaccounted for 300 background selection effects, as well as by direct purifying selection. A potential solution is thus 301 to correct for these effects when performing inference of population history. A promising first 302 approach to estimating direct selection effects, DFE-alpha, takes a step-wise approach to infer 303 demography using a presumed neutral class (synonymous sites); conditional on that demography, shapes, in order to assess whether demographic inference may be improved simply by correcting 319 for these selection effects without inferring their underlying parameter values. This approach 320 thus utilizes functional (i.e., directly selected) regions, a potential advantage in populations for 321 which only coding data may be available (e.g., exome-capture data; see Jones and Good 2016), 322 or generally in organisms with high gene densities. 323
In order to illustrate this solution, a functional genomic element was simulated under 324 demographic equilibrium, 2-fold exponential population growth and 2-fold exponential 325 population decline with four different DFE shapes (as described previously, and shown in Figure  326 4). Inference was first performed assuming strict neutrality, and inferring a one-epoch size 327 change (thus estimating the ancestral (Nanc) and current population sizes (Ncur)). As found in the 328 other inference approaches examined, population sizes were under-estimated and a false 329 inference of population growth was observed in almost all cases when selective effects are 330 ignored (Figure 4) . Indeed, the reduction in diversity resulting from BGS (B) was found to differ 331 by demographic scenario, disproportionately amplifying mis-inference under certain models 332 ( Figure 5 ). Next, the assumption of neutrality was relaxed, and mutations were simulated with 333 fitness effects characterized by a discrete DFE, with the same fitness classes given above (f0, f1, 334 f2, f3). Values for fi were drawn from a uniform prior between 0 and 1 such that ∑fi = 1. Note that 335 no assumptions were made about which sites in the genomic region were functionally important. 336
These directly selected sites were then used to infer demographic parameters. We found that by 337 varying the shape of the DFE, averaging across all realizations, and estimating only parameters 338 related to population history, highly accurate inference of modern and ancestral population size 339 . CC-BY-ND 4.0 International license was not certified by peer review) is the author/funder. It is made available under a The copyright holder for this preprint (which this version posted April 29, 2020. . https://doi.org/10.1101/2020.04.28.066365 doi: bioRxiv preprint is possible (Figure 4) . These results demonstrate that even if the true DFE of a population is 340 unknown (as will always be the case empirically), it is possible to infer the demographic history 341 with reasonable accuracy by approximately accounting for these selective effects. It is important to note that background selection effects extend to genomic distances in a 359 way that is positively related to the strength of purifying selection. For instance, strongly and 360 moderately deleterious mutations affect patterns of diversity at large genomic distances, whereas 361 mildly deleterious mutations primarily skew allele frequencies at adjacent sites. Thus, if 362 intergenic regions further away from exons are used to perform demographic inference, strongly 363 deleterious mutations are likely to predominantly bias inference. In contrast, if synonymous sites 364 are used to infer demographic history, mildly deleterious mutations will more predominantly 365 influence inference. Thus, as we here focused on relatively sparsely-coding genomes (resembling 366 human-like densities) and used intergenic sites to perform inference, moderately and strongly 367 deleterious mutations resulted in more severe demographic mis-inference. These results suggest 368 that demographic mis-inference will become stronger when such approaches are applied to 369 smaller, and more compact, genomes with higher gene densities. 370 . CC-BY-ND 4.0 International license was not certified by peer review) is the author/funder. It is made available under a The copyright holder for this preprint (which this version posted April 29, 2020. . https://doi.org/10.1101/2020.04.28.066365 doi: bioRxiv preprint Comparing the two methods investigated here, it appears that fastsimcoal2 is less prone 371 to false fluctuations in population size caused by background selection. However, both methods 372 falsely infer growth under alternative models, which is exacerbated as the density of coding 373 regions increases. The correspondingly inferred times of population growth inferred by both 374 methods appear to be relatively randomly affected. Further, we observed little difference in 375 performance when using all SNPs relative to thinning SNPs to be separated by 5kb (Supp Figure  376 6), presumably because the models investigated do not generate strong LD. Overall, the degree 377 of mis-inference caused by a neglect of BGS is largely similar between the two methods. In sum, we find that the effects of purifying and background selection result in similar 401 demographic mis-inference across approaches, and that masking functional sites does not yield 402 accurate parameter estimates. In order to side-step many of these difficulties, our proposed 403 approach of inferring demography by averaging selection effects across all possible DFE 404 realizations within an ABC framework appears to be highly promising. Utilizing only functional 405 regions, we found a great improvement in accuracy, without making any assumptions regarding 406 the true underlying shape of the DFE or the neutrality of particular classes of sites. As such, this 407 approach represents a more computationally-efficient avenue if only demographic parameters are 408 of interest, and ought to be particularly useful in the great majority of organisms in which 409 unlinked neutral sites either do not exist, or are difficult to identify and verify. Schiffels and Durbin (2014) . The X-axis is in years (assuming a generation time of 30 years). Note that the Y-axes are on different scales, and the magnitude of change observed in the empirical data is considerably larger than that observed in the simulated data. Thus, this comparison is only meant to illustrate this common shape taken in MSMC plots (and see similar shapes in, for example, vervets (Warren et al. 2015 ; Figure 4 ) and passenger pigeons (Hung et al. 2014; Figure 2) ).
. CC-BY-ND 4.0 International license was not certified by peer review) is the author/funder. It is made available under a The copyright holder for this preprint (which this version posted April 29, 2020. . https://doi.org/10.1101/2020.04.28.066365 doi: bioRxiv preprint . CC-BY-ND 4.0 International license was not certified by peer review) is the author/funder. It is made available under a The copyright holder for this preprint (which this version posted April 29, 2020. . https://doi.org/10.1101/2020.04.28.066365 doi: bioRxiv preprint Supp Figure 6 : Demographic inference by fastsimcoal2 when performed using all SNPs (right column) and when SNPs are thinned to be separated by 5 kb (left column). (a) Direct purifying selection (exonic sites are not masked) in 5% of the genome given by the DFE: f0 = f1 = f2 = f3 = 0.25. (b) Direct purifying selection (exonic sites are not masked) in 5% of the genome given by the DFE: f0 =0.5, f1 = 0.0, f2 = 0.0, f3 = 0.5. (c) Direct purifying selection (exonic sites are not masked) in 10% of the genome given by the DFE: f0 =0.1, f1 = 0.7, f2 = 0.1, f3 = 0.1. (d) Direct purifying selection (exonic sites are not masked) in 10% of the genome given by the DFE: f0 =0.7, f1 = 0.0, f2 = 0.0, f3 = 0.3. (e) Background selection (i.e., exonic sites are masked) in which 5% of the genome is exonic and given by the DFE: f0 =0.5, f1 = 0.0, f2 = 0.0, f3 = 0.5. (f) Background selection (i.e., exonic sites are masked) in which 20% of the genome is exonic and given by the DFE: f0 =0.1, f1 = 0.7, f2 = 0.1, f3 = 0.1. (g) Background selection (i.e., exonic sites are masked) in which 20% of the genome is exonic and given by the DFE: f0 =0.1, f1 = 0.1, f2 = 0.7, f3 = 0.1. (h) Background selection (i.e., exonic sites are masked) in which 20% of the genome is exonic and given by the DFE: f0 = f1 = f2 = f3 = 0.25.
. CC-BY-ND 4.0 International license was not certified by peer review) is the author/funder. It is made available under a The copyright holder for this preprint (which this version posted April 29, 2020. . https://doi.org/10.1101/2020.04.28.066365 doi: bioRxiv preprint
