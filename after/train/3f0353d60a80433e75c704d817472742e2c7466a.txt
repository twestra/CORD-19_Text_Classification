In molecular epidemiology, the identification of clusters of transmissions typically requires the alignment of viral genomic sequence data. However, existing methods of multiple sequence alignment scale poorly with respect to the number of sequences. Results: ViralMSA is a user-friendly reference-guided multiple sequence alignment tool that was built to enable the alignment of ultra-large viral genome datasets. It scales linearly with the number of sequences, and it is able to align tens of thousands of full viral genomes in seconds. Availability: ViralMSA is freely available at https://github.com/niemasd/ViralMSA as an open-source software project.
Real-time or near real-time surveillance of the spread of a pathogen can provide actionable information for public health response (Poon et al ., 2016) . Though there is currently no consensus in the world of molecular epidemiology regarding a formal definition of what exactly constitutes a "transmission cluster" (Novitsky et al ., 2017) , all current methods of inferring transmission clusters require a multiple sequence alignment (MSA) of the viral genomes: distance-based methods of transmission clustering require knowledge of homology for accurate distance measurement (Pond et al ., 2018) , and phylogenetic methods of transmission clustering require the MSA as a precursor to phylogenetic inference (Balaban et al ., 2019; Rose et al ., 2017; Ragonnet-Cronin et al ., 2013; Prosperi et al ., 2011) .
The standard tools for performing MSA such as MAFFT, MUSCLE, and Clustal Omega typically utilize progressive-iterative approaches due to their broad applicability (Katoh & Standley, 2013; Edgar, 2004; Sievers & Higgins, 2014) . However, these methods become prohibitively slow for real-time pathogen surveillance as the number of viral genomes grows. For example, during the COVID-19 pandemic, the number of viral genome assemblies available from around the world grew exponentially in the initial months of the pandemic, but MAFFT, the fastest of the aforementioned MSA tools, scales quadratically with respect to the number of sequences.
In the case of closely-related viral sequences for which a high-confidence reference genome exists, MSA can be accelerated by comparing each viral genome in the dataset against the reference genome and then using the reference as an anchor with which the individual alignments can be merged into a single MSA.
Here, we introduce ViralMSA, a user-friendly open-source MSA tool that utilizes read mappers such as Minimap2 (Li, 2018) to enable the reference-guided alignment of ultra-large viral genome datasets.
VIRULIGN is another reference-guided MSA tool designed for viral genomes (Libin et al ., 2019) . While VIRULIGN also aims to support MSA of large sequence datasets, its primary objective is to produce codon-correct alignments, whereas ViralMSA's objective is to produce alignments for use in transmission clustering as fast as possible. Thus, while ViralMSA is not guaranteed to yield codon-aware alignments, it is orders of magnitude faster than VIRULIGN, which is critical for rapidly-growing epidemics. Further, VIRULIGN is codon-aware, making it appropriate for coding regions, whereas ViralMSA is appropriate for the alignment of whole viral genomes. Lastly, VIRULIGN requires a thorough annotation of the reference genome, which may be difficult to obtain (especially towards the beginning of a novel outbreak) and does not provide the user to easily utilize different reference genomes for different viral strains. ViralMSA, on the other . CC-BY 4.0 International license was not certified by peer review) is the author/funder. It is made available under a The copyright holder for this preprint (which this version posted April 21, 2020. . https://doi.org/10.1101/2020.04.20.052068 doi: bioRxiv preprint N. Moshiri hand, only requires the reference genome assembly's GenBank accession number and can build any required index files on-the-fly
ViralMSA is written in Python 3 and is thus cross-platform. ViralMSA depends on BioPython (Cock et al ., 2009 ) as well as on whichever read mapper the user chooses to utilize, which is Minimap2 by default (Li, 2018) . In addition to Minimap2, ViralMSA supports STAR (Dobin et al ., 2013) , Bowtie 2 (Langmead & Salzberg, 2012) , and HISAT2 (Kim et al ., 2019) , though the default of Minimap2 is strongly recommended for both performance and accuracy (Fig. 1) .
ViralMSA takes the following as input: (1) a FASTA file containing the viral genomes to align, (2) the GenBank accession number of the reference genome to use, and (3) the mapper to utilize (Minimap2 by default). ViralMSA will pull the reference genome from GenBank and generate an index using the selected mapper, both of which will be cached for future alignments of the same viral strain, and will then execute the mapping. ViralMSA will then process the results and output a multiple sequence alignment in the FASTA format. For commonly-studied viruses (e.g. HIV, SARS-CoV-2), the user can simply provide the name of the virus instead of an accession number, and ViralMSA will automatically select what we believe would be an appropriate reference genome.
Because it uses the positions of the reference genome as anchors with which to merge the individual pairwise alignments, ViralMSA only keeps matches, mismatches, and deletions with respect to the reference genome: it discards all insertions with respect to the reference genome. For closely-related viral strains, insertions with respect to the reference genome are typically unique and thus lack usable phylogenetic or transmission clustering information, so their removal results in little to no impact on downstream analyses (Fig. 1b) . 
In order to test ViralMSA's accuracy, we obtained a curated HIV-1 full genome MSA from the Los Alamos National Laboratory (LANL) HIV Sequence Database, which we used as our ground truth. We then used both MAFFT and ViralMSA (using the HXB2 reference genome) to recompute MSAs. No other MSA tools were included in the comparison due to being orders of magnitude slower than MAFFT (which would render the full experiment infeasible).
Because ViralMSA's objective is to be utilized in transmission clustering workflows, which typically rely on pairwise distances between samples, we computed pairwise sequence distances between every pair of samples in each MSA (true, MAFFT, and ViralMSA) under the TN93 model of sequence evolution (Tamura & Nei, 1993) using pairwise distance calculator implemented in HIV-TRACE (Pond et al., 2018) . Then, for each estimated MSA, we measured alignment accuracy by computing the Mantel correlation test (using Spearman correlation) between the true and estimated MSAs.
In order to measure performance, we subsampled the full HIV dataset into datasets of n = 100, 200, 500, 1,000, and 2,000 sequences, with 10 replicates for each value of n . We then computed MSAs of each subsampled alignment replicate.
The results of the accuracy and performance experiments can be found in Figure 1 . As can be seen, ViralMSA in its default mode is consistently orders of magnitude faster than MAFFT (Fig. 1a ), yet it produces MSAs with the same level of accuracy (Fig. 1b) .
